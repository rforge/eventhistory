* Lava some data
#+BEGIN_SRC R  :results output :exports both  :session *R* :cache no
library(lava)
library(prodlim)
## library(survival)
m <- crModel()
addvar(m) <- ~X1+X2+X3+X4+X5+X6
distribution(m,"X3") <- binomial.lvm()
distribution(m,"X4") <- normal.lvm(mean=50,sd=10)
distribution(m,"eventtime1") <- coxWeibull.lvm(scale=1/200)
distribution(m,"censtime") <- coxWeibull.lvm(scale=1/1000)
m <- categorical(m,K=4,eventtime1~X5,beta=c(1,0,0,0),p=c(0.1,0.2,0.3))
m <- categorical(m,K=3,eventtime1~X1,beta=c(2,1,0),p=c(0.3,0.2))
regression(m,to="eventtime1",from=c("X2","X4")) <- c(0.3,0)
regression(m,to="eventtime2",from=c("X2","X4")) <- c(0.6,-0.07)
set.seed(17)
d <- sim(m,200)
d$X1 <- factor(d$X1,levels=c(0,1,2),labels=c("low survival","medium survival","high survival"))
## d$X3 <- factor(d$X3,levels=c(0,1),labels=c("high survival","low survival"))
d$X5 <- factor(d$X5,levels=c("0","1","2","3"),labels=c("one","two","three","four"))
d$Event <- factor(d$event,levels=c("0","1","2"),labels=c("0","cause-1","cause-2"))
d$status <- 1*(d$event!=0)
head(d)
#+END_SRC

#+RESULTS:
#+begin_example
  eventtime1 eventtime2  censtime      time              X1         X2 X3       X4    X5
1   4.835648   42.80407 55.969139  4.835648 medium survival  0.2375120  0 46.48290   one
2  11.857155   36.95113 16.025698 11.857155   high survival  0.1788684  1 44.52834 three
3  18.163999   90.63560  6.377146  6.377146 medium survival -1.9009896  0 50.62202 three
4   4.805116   19.23245 43.016611  4.805116   high survival  1.5901963  0 53.56744   two
5   4.236181    6.80737  2.823978  2.823978   high survival  1.5462582  0 40.87287   two
6  17.183443   62.65238 45.148577 17.183443   high survival -2.3390492  1 52.40915  four
           X6 event   Event status
1  0.73842735     1 cause-1      1
2 -0.65837580     1 cause-1      1
3  0.84023350     0       0      0
4  0.16059842     1 cause-1      1
5  1.38629432     0       0      0
6 -0.09119535     1 cause-1      1
#+end_example

* Survival
** No covariates
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
s0 <- prodlim(Hist(time,status)~1,data=d)
print(s0)
#+END_SRC   

#+RESULTS:
#+begin_example

Call: prodlim(formula = Hist(time, status) ~ 1, data = d)

Kaplan-Meier estimator for the event time survival function

No covariates

Right-censored response of a survival model 

No.Observations: 200 

Pattern:
                Freq
 event          181 
 right.censored 19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(s0,intervals=TRUE)
#+END_SRC   

#+RESULTS:
:   time0      time1 n.risk n.event n.lost      surv     se.surv     lower     upper
: 1  0.00  0.5810848    200       0      0 0.9950000 0.004987484 0.9852247 1.0000000
: 2  0.58  3.8700543    200      49      1 0.7543860 0.030481926 0.6946425 0.8141294
: 3  3.87  6.9732842    150      47      3 0.5159197 0.035547852 0.4462472 0.5855922
: 4  6.97 11.7665526    100      41      9 0.2932624 0.033263733 0.2280667 0.3584581
: 5 11.77 31.6129345     50      43      6 0.0000000         NaN       NaN       NaN

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(s0,times=1:10)
#+END_SRC   

#+RESULTS:
:  [1] 0.9750000 0.9200000 0.8499415 0.7392982 0.6587170 0.5827112 0.5107605 0.4428191 0.4001377
: [10] 0.3566989

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/s0.png" :exports both :session *R* :cache no 
plot(s0)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/s0.png]]

** Subset
#+BEGIN_SRC R :exports both :results output   :session *R* 
su <- prodlim(Hist(time,status)~1,data=d,subset=d$X1=="medium survival")
print(su)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, status) ~ 1, data = d, subset = d$X1 == 
    "medium survival")

Kaplan-Meier estimator for the event time survival function

No covariates

Right-censored response of a survival model 

No.Observations: 46 

Pattern:
                Freq
 event          44  
 right.censored 2
#+end_example

** A single binary covariate
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
s1 <- prodlim(Hist(time,status)~X1,data=d)
print(s1)
#+END_SRC   

#+RESULTS:
#+begin_example

Call: prodlim(formula = Hist(time, status) ~ X1, data = d)

Stratified Kaplan-Meier estimator for the conditional event time survival function

Discrete predictor variable: X1 (low survival, medium survival, high survival)

Right-censored response of a survival model 

No.Observations: 200 

Pattern:
                Freq
 event          181 
 right.censored 19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(s1,intervals=TRUE,newdata=data.frame(X1=c("medium survival","high survival","low survival")))
#+END_SRC   

#+RESULTS:
#+begin_example
X1=low survival    :
  time0      time1 n.risk n.event n.lost surv    se.surv     lower     upper
1  0.00  0.5810848     50       0      0 1.00 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     50      21      0 0.58 0.06979971 0.4431951 0.7168049
3  3.87  6.9732842     29      16      0 0.26 0.06203225 0.1384190 0.3815810
4  6.97 11.7665526     13      11      2   NA         NA        NA        NA
5 11.77 31.6129345      0       0      0   NA         NA        NA        NA

X1=medium survival :
  time0      time1 n.risk n.event n.lost      surv    se.surv      lower     upper
1  0.00  0.5810848     46       0      0 0.9782609 0.02150154 0.93611863 1.0000000
2  0.58  3.8700543     46      12      0 0.7391304 0.06474308 0.61223634 0.8660245
3  3.87  6.9732842     34      12      1 0.4747826 0.07407439 0.32959947 0.6199657
4  6.97 11.7665526     21      12      1 0.1929275 0.06025882 0.07482242 0.3110327
5 11.77 31.6129345      8       8      0        NA         NA         NA        NA

X1=high survival   :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848    104       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543    104      16      1 0.8454378 0.03553742 0.7757857 0.9150899
3  3.87  6.9732842     87      19      2 0.6584296 0.04691963 0.5664688 0.7503903
4  6.97 11.7665526     66      18      6 0.4684746 0.05052666 0.3694441 0.5675050
5 11.77 31.6129345     42      35      6 0.0000000        NaN       NaN       NaN
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(s1,times=0:10,newdata=data.frame(X1=c("medium survival","low survival","high survival")))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X1=medium survival`
 [1] 1.0000000 0.9347826 0.8913043 0.8695652 0.7391304 0.6304348 0.5652174 0.4747826 0.4069565
[10] 0.3617391 0.2652754

$`X1=low survival   `
 [1] 1.0000 0.9800 0.8800 0.7200 0.5200 0.4600 0.3200 0.2400 0.0900 0.0225     NA

$`X1=high survival  `
 [1] 1.0000000 0.9903846 0.9519231 0.9037439 0.8454378 0.7673365 0.7181482 0.6584296 0.6281791
[10] 0.5972851 0.5559023
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/s1.png" :exports both :session *R* :cache no 
plot(s1)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/s1.png]]

** A single continuous covariate
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
s2 <- prodlim(Hist(time,status)~X2,data=d)
print(s2)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, status) ~ X2, data = d)

Stone-Beran estimator for the conditional event time survival function

Continuous predictors: X2

Right-censored response of a survival model 

No.Observations: 200 

Pattern:
                Freq
 event          181 
 right.censored 19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(s2,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example
Warning in summary.prodlim(s2, intervals = TRUE) :
  
Life tables are available for 200 different covariate constellations.
 Shown are the table corresponding to the first row in object$X, corresponding to the middle row (median of the number of rows in object$X)  and corresponding to the last row in object$X ...
 to see more tables use arguments `newdata' and `max.tables'

X2=-3.494 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     31       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     31       4      0 0.8709677 0.06021010 0.7529581 0.9889774
3  3.87  6.9732842     27       6      1 0.6744868 0.08468947 0.5084985 0.8404751
4  6.97 11.7665526     20       5      1 0.5016496 0.09184127 0.3216440 0.6816551
5 11.77 31.6129345     14      11      2 0.0000000        NaN       NaN       NaN

X2=-0.066 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     61       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     61      13      0 0.7868852 0.05243214 0.6841201 0.8896503
3  3.87  6.9732842     48      15      1 0.5395785 0.06398706 0.4141661 0.6649908
4  6.97 11.7665526     32      13      3 0.3067779 0.06111883 0.1869872 0.4265686
5 11.77 31.6129345     16      15      1        NA         NA        NA        NA

X2= 3.940 :
  time0      time1 n.risk n.event n.lost      surv    se.surv      lower     upper
1  0.00  0.5810848     31       0      0 0.9677419 0.03173351 0.90554540 1.0000000
2  0.58  3.8700543     31      13      1 0.5722300 0.09003102 0.39577245 0.7486876
3  3.87  6.9732842     17      11      0 0.2019635 0.07354274 0.05782241 0.3461047
4  6.97 11.7665526      6       3      0 0.1009818 0.05524207 0.00000000 0.2092542
5 11.77 31.6129345      3       3      0        NA         NA         NA        NA
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(s2,times=0:10,newdata=data.frame(X2=quantile(d$X2)))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X2=-3.494`
 [1] 1.0000000 1.0000000 1.0000000 0.9354839 0.8709677 0.8064516 0.7741935 0.6744868 0.5733138
[10] 0.5733138 0.5374817

$`X2=-0.799`
 [1] 1.0000000 0.9836066 0.9672131 0.9180328 0.8196721 0.7369922 0.6364932 0.5527441 0.5192445
[10] 0.4857448 0.4180756

$`X2=-0.061`
 [1] 1.0000000 1.0000000 0.9180328 0.8688525 0.7377049 0.6721311 0.6065574 0.5227166 0.4552693
[10] 0.4202486 0.3837052

$`X2= 0.710`
 [1] 1.0000000 0.9508197 0.8852459 0.7868852 0.6557377 0.5901639 0.4918033 0.4098361 0.3261432
[10] 0.2536670 0.2174288

$`X2= 3.940`
 [1] 1.0000000 0.9354839 0.8709677 0.7741935 0.5722300 0.3702665 0.2692847 0.2019635 0.2019635
[10] 0.1683029 0.1346424
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/s2.png" :exports both :session *R* :cache no 
plot(s2)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/s2.png]]

** Combination of two categorical covariates
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
s1a <- prodlim(Hist(time,status)~X1+X3,data=d)
print(s1a)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, status) ~ X1 + X3, data = d)

Stratified Kaplan-Meier estimator for the conditional event time survival function

Discrete predictor variables:

 -  X1 (low survival, medium survival, high survival)
 -  X3 (0, 1)

Right-censored response of a survival model 

No.Observations: 200 

Pattern:
                Freq
 event          181 
 right.censored 19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(s1a,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example
X1=low survival   , X3=0 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     31       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     31      14      0 0.5483871 0.08938115 0.3732033 0.7235709
3  3.87  6.9732842     17       9      0 0.2580645 0.07858983 0.1040313 0.4120978
4  6.97 11.7665526      8       7      1        NA         NA        NA        NA
5 11.77 31.6129345      0       0      0        NA         NA        NA        NA

X1=medium survival, X3=0 :
  time0      time1 n.risk n.event n.lost      surv    se.surv      lower     upper
1  0.00  0.5810848     24       0      0 1.0000000 0.00000000 0.00000000 1.0000000
2  0.58  3.8700543     24       9      0 0.6250000 0.09882118 0.43131405 0.8186859
3  3.87  6.9732842     15       3      1 0.4965278 0.10276106 0.29511980 0.6979358
4  6.97 11.7665526     11       6      0 0.2256944 0.08796963 0.05327715 0.3981117
5 11.77 31.6129345      5       5      0        NA         NA         NA        NA

X1=high survival  , X3=0 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     53       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     53      11      1 0.7907757 0.05613520 0.6807527 0.9007987
3  3.87  6.9732842     41       7      1 0.6541579 0.06607080 0.5246615 0.7836543
4  6.97 11.7665526     33       9      5 0.4546502 0.07230591 0.3129333 0.5963672
5 11.77 31.6129345     19      15      4        NA         NA        NA        NA

X1=low survival   , X3=1 :
  time0      time1 n.risk n.event n.lost      surv   se.surv     lower     upper
1  0.00  0.5810848     19       0      0 1.0000000 0.0000000 0.0000000 1.0000000
2  0.58  3.8700543     19       7      0 0.6315789 0.1106647 0.4146801 0.8484778
3  3.87  6.9732842     12       7      0 0.2631579 0.1010226 0.0651572 0.4611586
4  6.97 11.7665526      5       4      1        NA        NA        NA        NA
5 11.77 31.6129345      0       0      0        NA        NA        NA        NA

X1=medium survival, X3=1 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     22       0      0 0.9545455 0.04440947 0.8675045 1.0000000
2  0.58  3.8700543     22       3      0 0.8636364 0.07316500 0.7202356 1.0000000
3  3.87  6.9732842     19       9      0 0.4545455 0.10615895 0.2464777 0.6626132
4  6.97 11.7665526     10       6      1 0.1558442 0.08098224 0.0000000 0.3145664
5 11.77 31.6129345      3       3      0        NA         NA        NA        NA

X1=high survival  , X3=1 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     51       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     51       5      0 0.9019608 0.04163980 0.8203483 0.9835733
3  3.87  6.9732842     46      12      1 0.6621067 0.06676008 0.5312594 0.7929541
4  6.97 11.7665526     33       9      1 0.4799270 0.07086593 0.3410324 0.6188217
5 11.77 31.6129345     23      20      2 0.0000000        NaN       NaN       NaN
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(s1a,times=0:10,newdata=expand.grid(X1=levels(d$X1),X3=unique(d$X3)))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X1=low survival   , X3=0`
 [1] 1.00000000 0.96774194 0.80645161 0.64516129 0.48387097 0.41935484 0.32258065 0.25806452
 [9] 0.04032258         NA         NA

$`X1=medium survival, X3=0`
 [1] 1.0000000 0.9166667 0.8750000 0.8333333 0.6250000 0.5416667 0.5416667 0.4965278 0.4513889
[10] 0.3611111 0.2708333

$`X1=high survival  , X3=0`
 [1] 1.0000000 0.9811321 0.9245283 0.8679245 0.7907757 0.7329140 0.7329140 0.6541579 0.6343350
[10] 0.6131905 0.5701183

$`X1=low survival   , X3=1`
 [1] 1.00000000 1.00000000 1.00000000 0.84210526 0.57894737 0.52631579 0.31578947 0.21052632
 [9] 0.15789474 0.05263158         NA

$`X1=medium survival, X3=1`
 [1] 1.0000000 0.9545455 0.9090909 0.9090909 0.8636364 0.7272727 0.5909091 0.4545455 0.3636364
[10] 0.3636364 0.2597403

$`X1=high survival  , X3=1`
 [1] 1.0000000 1.0000000 0.9803922 0.9411765 0.9019608 0.8025536 0.7022344 0.6621067 0.6219790
[10] 0.5818513 0.5417237
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/s1a.png" :exports both :session *R* :cache no 
plot(s1a,confint=FALSE,atrisk=FALSE,legend.x="bottomleft",legend.cex=0.8)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/s1a.png]]

** Combination of one categorical and one continuous covariate
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
s3 <- prodlim(Hist(time,status)~X1+X2,data=d)
print(s3)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, status) ~ X1 + X2, data = d)

Stratified Stone-Beran estimator for the conditional event time survival function

  Discrete predictor variables: X1
Continuous predictor variables: X2

Right-censored response of a survival model 

No.Observations: 200 

Pattern:
                Freq
 event          181 
 right.censored 19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(s3,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example
Warning in summary.prodlim(s3, intervals = TRUE) :
  
Life tables are available for 200 different covariate constellations.
 Shown are the table corresponding to the first row in object$X, corresponding to the middle row (median of the number of rows in object$X)  and corresponding to the last row in object$X ...
 to see more tables use arguments `newdata' and `max.tables'

X1=low survival , X2=-2.2 :
  time0      time1 n.risk n.event n.lost      surv   se.surv      lower     upper
1  0.00  0.5810848     13       0      0 1.0000000 0.0000000 0.00000000 1.0000000
2  0.58  3.8700543     13       5      0 0.6153846 0.1349320 0.35092275 0.8798465
3  3.87  6.9732842      8       4      0 0.3076923 0.1280077 0.05680175 0.5585829
4  6.97 11.7665526      4       3      1        NA        NA         NA        NA
5 11.77 31.6129345      0       0      0        NA        NA         NA        NA

X1=high survival, X2=-1.9 :
  time0      time1 n.risk n.event n.lost      surv    se.surv     lower     upper
1  0.00  0.5810848     23       0      0 1.0000000 0.00000000 0.0000000 1.0000000
2  0.58  3.8700543     23       1      0 0.9565217 0.04252258 0.8731790 1.0000000
3  3.87  6.9732842     22       3      0 0.8260870 0.07903420 0.6711828 0.9809911
4  6.97 11.7665526     19       3      1 0.6905371 0.09746224 0.4995146 0.8815596
5 11.77 31.6129345     15      11      3 0.0000000        NaN       NaN       NaN

X1=high survival, X2= 3.9 :
  time0      time1 n.risk n.event n.lost      surv    se.surv       lower     upper
1  0.00  0.5810848     20       0      0 1.0000000 0.00000000 0.000000000 1.0000000
2  0.58  3.8700543     20       4      1 0.7941176 0.09192128 0.613955249 0.9742800
3  3.87  6.9732842     15       8      0 0.3705882 0.11092243 0.153184264 0.5879922
4  6.97 11.7665526      7       3      1 0.1852941 0.09379907 0.001451326 0.3691369
5 11.77 31.6129345      3       3      0        NA         NA          NA        NA
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(s3,times=0:10,newdata=expand.grid(X1=levels(d$X1),X2=c(quantile(d$X2,0.05),median(d$X2))))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X1=low survival   , X2=-1.745`
 [1] 1.00000000 1.00000000 1.00000000 0.80000000 0.66666667 0.66666667 0.46666667 0.26666667
 [9] 0.06666667 0.06666667         NA

$`X1=medium survival, X2=-1.745`
 [1] 1.0000000 0.9285714 0.9285714 0.9285714 0.7857143 0.6428571 0.5714286 0.4897959 0.4897959
[10] 0.4897959 0.4081633

$`X1=high survival  , X2=-1.745`
 [1] 1.0000000 1.0000000 0.9600000 0.9600000 0.9200000 0.8800000 0.8800000 0.8000000 0.7600000
[10] 0.7200000 0.6776471

$`X1=low survival   , X2=-0.061`
 [1] 1.000 1.000 0.880 0.760 0.520 0.480 0.320 0.280 0.096    NA    NA

$`X1=medium survival, X2=-0.061`
 [1] 1.0000000 1.0000000 0.9565217 0.9565217 0.9130435 0.7826087 0.6956522 0.5652174 0.4782609
[10] 0.4782609 0.3347826

$`X1=high survival  , X2=-0.061`
 [1] 1.0000000 1.0000000 0.9743590 0.8974359 0.8461538 0.7692308 0.6923077 0.6400000 0.6133333
[10] 0.5854545 0.5296970
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/s3.png" :exports both :session *R* :cache no 
plot(s3,confint=FALSE,atrisk=FALSE,legend.x="bottomleft",legend.cex=0.8,newdata=expand.grid(X1=levels(d$X1),X2=c(quantile(d$X2,0.05),median(d$X2))))
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/s3.png]]

* Competing risks
** No covariates
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
f0 <- prodlim(Hist(time,event)~1,data=d)
print(f0)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, event) ~ 1, data = d)


No covariates

Right-censored response of a competing.risks model 

No.Observations: 200 

Pattern:
         
Cause     event right.censored
  1         173              0
  2           8              0
  unknown     0             19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(f0,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example


----------> Cause:  1 

  time0      time1 n.risk n.event n.lost    cuminc   se.cuminc     lower      upper
1  0.00  0.5810848    200       0      0 0.0050000 0.004987484 0.0000000 0.01477529
2  0.58  3.8700543    200      48      1 0.2406140 0.030270505 0.1812849 0.29994314
3  3.87  6.9732842    150      47      3 0.4790803 0.035534895 0.4094332 0.54872742
4  6.97 11.7665526    100      39      9 0.6912432 0.033721667 0.6251499 0.75733646
5 11.77 31.6129345     50      38      6 0.9508450         NaN       NaN        NaN


----------> Cause:  2 

  time0      time1 n.risk n.event n.lost     cuminc   se.cuminc lower      upper
1  0.00  0.5810848    200       0      0 0.00000000 0.000000000     0 0.00000000
2  0.58  3.8700543    200       1      1 0.00500000 0.004987484     0 0.01477529
3  3.87  6.9732842    150       0      3 0.00500000 0.004987484     0 0.01477529
4  6.97 11.7665526    100       2      9 0.01549437 0.008879329     0 0.03289753
5 11.77 31.6129345     50       5      6 0.04915505         NaN   NaN        NaN
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(f0,times=1:10)
#+END_SRC   

#+RESULTS:
:  [1] 0.0250000 0.0800000 0.1450585 0.2557018 0.3362830 0.4122888 0.4842395 0.5416866 0.5843679
: [10] 0.6278068

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/f0.png" :exports both :session *R* :cache no 
plot(f0)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/f0.png]]

** A single binary covariate
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
f1 <- prodlim(Hist(time,event)~X1,data=d)
print(f1)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, event) ~ X1, data = d)


Discrete predictor variable: X1 (low survival, medium survival, high survival)

Right-censored response of a competing.risks model 

No.Observations: 200 

Pattern:
         
Cause     event right.censored
  1         173              0
  2           8              0
  unknown     0             19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(f1,intervals=TRUE,newdata=data.frame(X1=c("medium survival","high survival","low survival")))
#+END_SRC   

#+RESULTS:
#+begin_example


----------> Cause:  1 

X1=low survival    :
  time0      time1 n.risk n.event n.lost cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     50       0      0   0.00 0.00000000 0.0000000 0.0000000
2  0.58  3.8700543     50      21      0   0.42 0.06979971 0.2831951 0.5568049
3  3.87  6.9732842     29      16      0   0.74 0.06203225 0.6184190 0.8615810
4  6.97 11.7665526     13      11      2     NA         NA        NA        NA
5 11.77 31.6129345      0       0      0     NA         NA        NA        NA

X1=medium survival :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc     lower      upper
1  0.00  0.5810848     46       0      0 0.02173913 0.02150154 0.0000000 0.06388137
2  0.58  3.8700543     46      11      0 0.23913043 0.06289174 0.1158649 0.36239598
3  3.87  6.9732842     34      12      1 0.50347826 0.07416587 0.3581158 0.64884070
4  6.97 11.7665526     21      12      1 0.78533333 0.06253871 0.6627597 0.90790696
5 11.77 31.6129345      8       8      0         NA         NA        NA         NA

X1=high survival   :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc      lower     upper
1  0.00  0.5810848    104       0      0 0.0000000 0.00000000 0.00000000 0.0000000
2  0.58  3.8700543    104      16      1 0.1545622 0.03553742 0.08491012 0.2242143
3  3.87  6.9732842     87      19      2 0.3415704 0.04691963 0.24960965 0.4335312
4  6.97 11.7665526     66      16      6 0.5112512 0.05057770 0.41212074 0.6103817
5 11.77 31.6129345     42      30      6 0.9150275        NaN        NaN       NaN



----------> Cause:  2 

X1=low survival    :
  time0      time1 n.risk n.event n.lost cuminc se.cuminc lower upper
1  0.00  0.5810848     50       0      0      0         0     0     0
2  0.58  3.8700543     50       0      0      0         0     0     0
3  3.87  6.9732842     29       0      0      0         0     0     0
4  6.97 11.7665526     13       0      2     NA        NA    NA    NA
5 11.77 31.6129345      0       0      0     NA        NA    NA    NA

X1=medium survival :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower      upper
1  0.00  0.5810848     46       0      0 0.00000000 0.00000000     0 0.00000000
2  0.58  3.8700543     46       1      0 0.02173913 0.02150154     0 0.06388137
3  3.87  6.9732842     34       0      1 0.02173913 0.02150154     0 0.06388137
4  6.97 11.7665526     21       0      1 0.02173913 0.02150154     0 0.06388137
5 11.77 31.6129345      8       0      0         NA         NA    NA         NA

X1=high survival   :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower      upper
1  0.00  0.5810848    104       0      0 0.00000000 0.00000000     0 0.00000000
2  0.58  3.8700543    104       0      1 0.00000000 0.00000000     0 0.00000000
3  3.87  6.9732842     87       0      2 0.00000000 0.00000000     0 0.00000000
4  6.97 11.7665526     66       2      6 0.02027422 0.01419083     0 0.04808775
5 11.77 31.6129345     42       5      6 0.08497254        NaN   NaN        NaN
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(f1,times=0:10,newdata=data.frame(X1=c("medium survival","low survival","high survival")))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X1=medium survival`
 [1] 0.00000000 0.06521739 0.10869565 0.10869565 0.23913043 0.34782609 0.41304348 0.50347826
 [9] 0.57130435 0.61652174 0.71298551

$`X1=low survival   `
 [1] 0.0000 0.0200 0.1200 0.2800 0.4800 0.5400 0.6800 0.7600 0.9100 0.9775     NA

$`X1=high survival  `
 [1] 0.000000000 0.009615385 0.048076923 0.096256137 0.154562193 0.232663515 0.281851751 0.341570426
 [9] 0.351546632 0.382440688 0.423823467
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/f1.png" :exports both :session *R* :cache no 
plot(f1)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/f1.png]]

** A single continuous covariate
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
f2 <- prodlim(Hist(time,event)~X2,data=d)
print(f2)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, event) ~ X2, data = d)


Continuous predictors: X2

Right-censored response of a competing.risks model 

No.Observations: 200 

Pattern:
         
Cause     event right.censored
  1         173              0
  2           8              0
  unknown     0             19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(f2,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example
Warning in summary.prodlim(f2, intervals = TRUE) :
  
Life tables are available for 200 different covariate constellations.
 Shown are the table corresponding to the first row in object$X, corresponding to the middle row (median of the number of rows in object$X)  and corresponding to the last row in object$X ...
 to see more tables use arguments `newdata' and `max.tables'



----------> Cause:  1 

X2=-3.494 :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc      lower     upper
1  0.00  0.5810848     31       0      0 0.0000000 0.00000000 0.00000000 0.0000000
2  0.58  3.8700543     31       4      0 0.1290323 0.06021010 0.01102263 0.2470419
3  3.87  6.9732842     27       6      1 0.3255132 0.08468947 0.15952489 0.4915015
4  6.97 11.7665526     20       4      1 0.4646261 0.09151434 0.28526129 0.6439909
5 11.77 31.6129345     14      10      2 0.9274575        NaN        NaN       NaN

X2=-0.066 :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     61       0      0 0.0000000 0.00000000 0.0000000 0.0000000
2  0.58  3.8700543     61      13      0 0.2131148 0.05243214 0.1103497 0.3158799
3  3.87  6.9732842     48      15      1 0.4604215 0.06398706 0.3350092 0.5858339
4  6.97 11.7665526     32      12      3 0.6763603 0.06194460 0.5549511 0.7977695
5 11.77 31.6129345     16      14      1        NA         NA        NA        NA

X2= 3.940 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     31       0      0 0.03225806 0.03173351 0.0000000 0.0944546
2  0.58  3.8700543     31      12      1 0.39551192 0.08900391 0.2210675 0.5699564
3  3.87  6.9732842     17      11      0 0.76577840 0.07742888 0.6140206 0.9175362
4  6.97 11.7665526      6       3      0 0.86676017 0.06203662 0.7451706 0.9883497
5 11.77 31.6129345      3       2      0         NA         NA        NA        NA



----------> Cause:  2 

X2=-3.494 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower      upper
1  0.00  0.5810848     31       0      0 0.00000000 0.00000000     0 0.00000000
2  0.58  3.8700543     31       0      0 0.00000000 0.00000000     0 0.00000000
3  3.87  6.9732842     27       0      1 0.00000000 0.00000000     0 0.00000000
4  6.97 11.7665526     20       1      1 0.03372434 0.03314205     0 0.09868156
5 11.77 31.6129345     14       1      2 0.07254246        NaN   NaN        NaN

X2=-0.066 :
  time0      time1 n.risk n.event n.lost     cuminc se.cuminc lower      upper
1  0.00  0.5810848     61       0      0 0.00000000 0.0000000     0 0.00000000
2  0.58  3.8700543     61       0      0 0.00000000 0.0000000     0 0.00000000
3  3.87  6.9732842     48       0      1 0.00000000 0.0000000     0 0.00000000
4  6.97 11.7665526     32       1      3 0.01686183 0.0167163     0 0.04962516
5 11.77 31.6129345     16       1      1         NA        NA    NA         NA

X2= 3.940 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower     upper
1  0.00  0.5810848     31       0      0 0.00000000 0.00000000     0 0.0000000
2  0.58  3.8700543     31       1      1 0.03225806 0.03173351     0 0.0944546
3  3.87  6.9732842     17       0      0 0.03225806 0.03173351     0 0.0944546
4  6.97 11.7665526      6       0      0 0.03225806 0.03173351     0 0.0944546
5 11.77 31.6129345      3       1      0         NA         NA    NA        NA
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(f2,times=0:10,newdata=data.frame(X2=quantile(d$X2)))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X2=-3.494`
 [1] 0.00000000 0.00000000 0.00000000 0.06451613 0.12903226 0.19354839 0.22580645 0.32551320
 [9] 0.39296188 0.39296188 0.42879399

$`X2=-0.799`
 [1] 0.00000000 0.01639344 0.03278689 0.08196721 0.18032787 0.26300784 0.36350677 0.44725588
 [9] 0.48075552 0.51425517 0.58192445

$`X2=-0.061`
 [1] 0.00000000 0.00000000 0.08196721 0.13114754 0.26229508 0.32786885 0.39344262 0.47728337
 [9] 0.52786885 0.56288957 0.59943293

$`X2= 0.710`
 [1] 0.00000000 0.04918033 0.11475410 0.21311475 0.34426230 0.40983607 0.50819672 0.59016393
 [9] 0.67385677 0.74633305 0.78257118

$`X2= 3.940`
 [1] 0.00000000 0.06451613 0.12903226 0.19354839 0.39551192 0.59747546 0.69845722 0.76577840
 [9] 0.76577840 0.79943899 0.83309958
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/f2.png" :exports both :session *R* :cache no 
plot(f2)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/f2.png]]

** Combination of two categorical covariates
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
f1a <- prodlim(Hist(time,event)~X1+X3,data=d)
print(f1a)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, event) ~ X1 + X3, data = d)


Discrete predictor variables:

 -  X1 (low survival, medium survival, high survival)
 -  X3 (0, 1)

Right-censored response of a competing.risks model 

No.Observations: 200 

Pattern:
         
Cause     event right.censored
  1         173              0
  2           8              0
  unknown     0             19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(f1a,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example


----------> Cause:  1 

X1=low survival   , X3=0 :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     31       0      0 0.0000000 0.00000000 0.0000000 0.0000000
2  0.58  3.8700543     31      14      0 0.4516129 0.08938115 0.2764291 0.6267967
3  3.87  6.9732842     17       9      0 0.7419355 0.07858983 0.5879022 0.8959687
4  6.97 11.7665526      8       7      1        NA         NA        NA        NA
5 11.77 31.6129345      0       0      0        NA         NA        NA        NA

X1=medium survival, X3=0 :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     24       0      0 0.0000000 0.00000000 0.0000000 0.0000000
2  0.58  3.8700543     24       8      0 0.3333333 0.09622504 0.1447357 0.5219310
3  3.87  6.9732842     15       3      1 0.4618056 0.10246733 0.2609733 0.6626378
4  6.97 11.7665526     11       6      0 0.7326389 0.09283731 0.5506811 0.9145967
5 11.77 31.6129345      5       5      0        NA         NA        NA        NA

X1=high survival  , X3=0 :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc      lower     upper
1  0.00  0.5810848     53       0      0 0.0000000 0.00000000 0.00000000 0.0000000
2  0.58  3.8700543     53      11      1 0.2092243 0.05613520 0.09920134 0.3192473
3  3.87  6.9732842     41       7      1 0.3458421 0.06607080 0.21634567 0.4753385
4  6.97 11.7665526     33       8      5 0.5255268 0.07246282 0.38350228 0.6675513
5 11.77 31.6129345     19      13      4        NA         NA         NA        NA

X1=low survival   , X3=1 :
  time0      time1 n.risk n.event n.lost    cuminc se.cuminc     lower     upper
1  0.00  0.5810848     19       0      0 0.0000000 0.0000000 0.0000000 0.0000000
2  0.58  3.8700543     19       7      0 0.3684211 0.1106647 0.1515222 0.5853199
3  3.87  6.9732842     12       7      0 0.7368421 0.1010226 0.5388414 0.9348428
4  6.97 11.7665526      5       4      1        NA        NA        NA        NA
5 11.77 31.6129345      0       0      0        NA        NA        NA        NA

X1=medium survival, X3=1 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     22       0      0 0.04545455 0.04440947 0.0000000 0.1324955
2  0.58  3.8700543     22       3      0 0.13636364 0.07316500 0.0000000 0.2797644
3  3.87  6.9732842     19       9      0 0.54545455 0.10615895 0.3373868 0.7535223
4  6.97 11.7665526     10       6      1 0.84415584 0.08098224 0.6854336 1.0000000
5 11.77 31.6129345      3       3      0         NA         NA        NA        NA

X1=high survival  , X3=1 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc     lower     upper
1  0.00  0.5810848     51       0      0 0.00000000 0.00000000 0.0000000 0.0000000
2  0.58  3.8700543     51       5      0 0.09803922 0.04163980 0.0164267 0.1796517
3  3.87  6.9732842     46      12      1 0.33789330 0.06676008 0.2070459 0.4687406
4  6.97 11.7665526     33       8      1 0.50000912 0.07091289 0.3610224 0.6389958
5 11.77 31.6129345     23      17      2 0.91354309        NaN       NaN       NaN



----------> Cause:  2 

X1=low survival   , X3=0 :
  time0      time1 n.risk n.event n.lost cuminc se.cuminc lower upper
1  0.00  0.5810848     31       0      0      0         0     0     0
2  0.58  3.8700543     31       0      0      0         0     0     0
3  3.87  6.9732842     17       0      0      0         0     0     0
4  6.97 11.7665526      8       0      1     NA        NA    NA    NA
5 11.77 31.6129345      0       0      0     NA        NA    NA    NA

X1=medium survival, X3=0 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower     upper
1  0.00  0.5810848     24       0      0 0.00000000 0.00000000     0 0.0000000
2  0.58  3.8700543     24       1      0 0.04166667 0.04078938     0 0.1216124
3  3.87  6.9732842     15       0      1 0.04166667 0.04078938     0 0.1216124
4  6.97 11.7665526     11       0      0 0.04166667 0.04078938     0 0.1216124
5 11.77 31.6129345      5       0      0         NA         NA    NA        NA

X1=high survival  , X3=0 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower      upper
1  0.00  0.5810848     53       0      0 0.00000000 0.00000000     0 0.00000000
2  0.58  3.8700543     53       0      1 0.00000000 0.00000000     0 0.00000000
3  3.87  6.9732842     41       0      1 0.00000000 0.00000000     0 0.00000000
4  6.97 11.7665526     33       1      5 0.01982297 0.01962272     0 0.05828279
5 11.77 31.6129345     19       2      4         NA         NA    NA         NA

X1=low survival   , X3=1 :
  time0      time1 n.risk n.event n.lost cuminc se.cuminc lower upper
1  0.00  0.5810848     19       0      0      0         0     0     0
2  0.58  3.8700543     19       0      0      0         0     0     0
3  3.87  6.9732842     12       0      0      0         0     0     0
4  6.97 11.7665526      5       0      1     NA        NA    NA    NA
5 11.77 31.6129345      0       0      0     NA        NA    NA    NA

X1=medium survival, X3=1 :
  time0      time1 n.risk n.event n.lost cuminc se.cuminc lower upper
1  0.00  0.5810848     22       0      0      0         0     0     0
2  0.58  3.8700543     22       0      0      0         0     0     0
3  3.87  6.9732842     19       0      0      0         0     0     0
4  6.97 11.7665526     10       0      1      0         0     0     0
5 11.77 31.6129345      3       0      0     NA        NA    NA    NA

X1=high survival  , X3=1 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower     upper
1  0.00  0.5810848     51       0      0 0.00000000 0.00000000     0 0.0000000
2  0.58  3.8700543     51       0      0 0.00000000 0.00000000     0 0.0000000
3  3.87  6.9732842     46       0      1 0.00000000 0.00000000     0 0.0000000
4  6.97 11.7665526     33       1      1 0.02006384 0.01986081     0 0.0589903
5 11.77 31.6129345     23       3      2 0.08645691        NaN   NaN       NaN
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(f1a,times=0:10,newdata=expand.grid(X1=levels(d$X1),X3=unique(d$X3)))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X1=low survival   , X3=0`
 [1] 0.00000000 0.03225806 0.19354839 0.35483871 0.51612903 0.58064516 0.67741935 0.74193548
 [9] 0.95967742         NA         NA

$`X1=medium survival, X3=0`
 [1] 0.00000000 0.08333333 0.12500000 0.12500000 0.33333333 0.41666667 0.41666667 0.46180556
 [9] 0.50694444 0.59722222 0.68750000

$`X1=high survival  , X3=0`
 [1] 0.00000000 0.01886792 0.07547170 0.13207547 0.20922432 0.26708595 0.26708595 0.34584207
 [9] 0.34584207 0.36698657 0.41005869

$`X1=low survival   , X3=1`
 [1] 0.0000000 0.0000000 0.0000000 0.1578947 0.4210526 0.4736842 0.6842105 0.7894737 0.8421053
[10] 0.9473684        NA

$`X1=medium survival, X3=1`
 [1] 0.00000000 0.04545455 0.09090909 0.09090909 0.13636364 0.27272727 0.40909091 0.54545455
 [9] 0.63636364 0.63636364 0.74025974

$`X1=high survival  , X3=1`
 [1] 0.00000000 0.00000000 0.01960784 0.05882353 0.09803922 0.19744642 0.29776562 0.33789330
 [9] 0.35795714 0.39808482 0.43821249
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/f1a.png" :exports both :session *R* :cache no 
plot(f1a,confint=FALSE,atrisk=FALSE,legend.x="bottomleft",legend.cex=0.8)
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/f1a.png]]

** Combination of one categorical and one continuous covariate
*** fit + print
#+BEGIN_SRC R :exports both :results output   :session *R* 
f3 <- prodlim(Hist(time,event)~X1+X2,data=d)
print(f3)
#+END_SRC   

#+RESULTS:
#+begin_example
 X11cairo 
       2

Call: prodlim(formula = Hist(time, event) ~ X1 + X2, data = d)


  Discrete predictor variables: X1
Continuous predictor variables: X2

Right-censored response of a competing.risks model 

No.Observations: 200 

Pattern:
         
Cause     event right.censored
  1         173              0
  2           8              0
  unknown     0             19
#+end_example

*** summary

#+BEGIN_SRC R :exports both :results output  :session *R*  
summary(f3,intervals=TRUE)
#+END_SRC   

#+RESULTS:
#+begin_example
Warning in summary.prodlim(f3, intervals = TRUE) :
  
Life tables are available for 200 different covariate constellations.
 Shown are the table corresponding to the first row in object$X, corresponding to the middle row (median of the number of rows in object$X)  and corresponding to the last row in object$X ...
 to see more tables use arguments `newdata' and `max.tables'



----------> Cause:  1 

X1=low survival , X2=-2.2 :
  time0      time1 n.risk n.event n.lost    cuminc se.cuminc     lower     upper
1  0.00  0.5810848     13       0      0 0.0000000 0.0000000 0.0000000 0.0000000
2  0.58  3.8700543     13       5      0 0.3846154 0.1349320 0.1201535 0.6490773
3  3.87  6.9732842      8       4      0 0.6923077 0.1280077 0.4414171 0.9431982
4  6.97 11.7665526      4       3      1        NA        NA        NA        NA
5 11.77 31.6129345      0       0      0        NA        NA        NA        NA

X1=high survival, X2=-1.9 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc      lower     upper
1  0.00  0.5810848     23       0      0 0.00000000 0.00000000 0.00000000 0.0000000
2  0.58  3.8700543     23       1      0 0.04347826 0.04252258 0.00000000 0.1268210
3  3.87  6.9732842     22       3      0 0.17391304 0.07903420 0.01900886 0.3288172
4  6.97 11.7665526     19       2      1 0.26598465 0.09325412 0.08320993 0.4487594
5 11.77 31.6129345     15      10      3 0.90719766        NaN        NaN       NaN

X1=high survival, X2= 3.9 :
  time0      time1 n.risk n.event n.lost    cuminc  se.cuminc      lower     upper
1  0.00  0.5810848     20       0      0 0.0000000 0.00000000 0.00000000 0.0000000
2  0.58  3.8700543     20       4      1 0.2058824 0.09192128 0.02571996 0.3860448
3  3.87  6.9732842     15       8      0 0.6294118 0.11092243 0.41200779 0.8468157
4  6.97 11.7665526      7       3      1 0.8147059 0.09379907 0.63086309 0.9985487
5 11.77 31.6129345      3       2      0        NA         NA         NA        NA



----------> Cause:  2 

X1=low survival , X2=-2.2 :
  time0      time1 n.risk n.event n.lost cuminc se.cuminc lower upper
1  0.00  0.5810848     13       0      0      0         0     0     0
2  0.58  3.8700543     13       0      0      0         0     0     0
3  3.87  6.9732842      8       0      0      0         0     0     0
4  6.97 11.7665526      4       0      1     NA        NA    NA    NA
5 11.77 31.6129345      0       0      0     NA        NA    NA    NA

X1=high survival, X2=-1.9 :
  time0      time1 n.risk n.event n.lost     cuminc  se.cuminc lower    upper
1  0.00  0.5810848     23       0      0 0.00000000 0.00000000     0 0.000000
2  0.58  3.8700543     23       0      0 0.00000000 0.00000000     0 0.000000
3  3.87  6.9732842     22       0      0 0.00000000 0.00000000     0 0.000000
4  6.97 11.7665526     19       1      1 0.04347826 0.04252258     0 0.126821
5 11.77 31.6129345     15       1      3 0.09280234        NaN   NaN      NaN

X1=high survival, X2= 3.9 :
  time0      time1 n.risk n.event n.lost cuminc se.cuminc lower upper
1  0.00  0.5810848     20       0      0      0         0     0     0
2  0.58  3.8700543     20       0      1      0         0     0     0
3  3.87  6.9732842     15       0      0      0         0     0     0
4  6.97 11.7665526      7       0      1      0         0     0     0
5 11.77 31.6129345      3       1      0     NA        NA    NA    NA
#+end_example

*** predict
#+BEGIN_SRC R :exports both :results output   :session *R*  
predict(f3,times=0:10,newdata=expand.grid(X1=levels(d$X1),X2=c(quantile(d$X2,0.05),median(d$X2))))
#+END_SRC   

#+RESULTS:
#+begin_example
$`X1=low survival   , X2=-1.745`
 [1] 0.0000000 0.0000000 0.0000000 0.2000000 0.3333333 0.3333333 0.5333333 0.7333333 0.9333333
[10] 0.9333333        NA

$`X1=medium survival, X2=-1.745`
 [1] 0.00000000 0.07142857 0.07142857 0.07142857 0.21428571 0.35714286 0.42857143 0.51020408
 [9] 0.51020408 0.51020408 0.59183673

$`X1=high survival  , X2=-1.745`
 [1] 0.0000000 0.0000000 0.0400000 0.0400000 0.0800000 0.1200000 0.1200000 0.2000000 0.2000000
[10] 0.2400000 0.2823529

$`X1=low survival   , X2=-0.061`
 [1] 0.000 0.000 0.120 0.240 0.480 0.520 0.680 0.720 0.904    NA    NA

$`X1=medium survival, X2=-0.061`
 [1] 0.00000000 0.00000000 0.04347826 0.04347826 0.08695652 0.21739130 0.30434783 0.43478261
 [9] 0.52173913 0.52173913 0.66521739

$`X1=high survival  , X2=-0.061`
 [1] 0.00000000 0.00000000 0.02564103 0.10256410 0.15384615 0.23076923 0.30769231 0.36000000
 [9] 0.36000000 0.38787879 0.44363636
#+end_example

*** plot
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/f3.png" :exports both :session *R* :cache no 
plot(f3,confint=FALSE,atrisk=FALSE,legend.x="bottomleft",legend.cex=0.8,newdata=expand.grid(X1=levels(d$X1),X2=c(quantile(d$X2,0.05),median(d$X2))))
#+END_SRC   

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/f3.png]]

* Special cases
** Compare with survfit (survival)

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compSurvival.png" :exports both :session *R* :cache yes 
library(survival)
data(pbc)
prodlim.0 <- prodlim(Hist(time,status!=0)~1,data=pbc)
survfit.0 <- survfit(Surv(time,status!=0)~1,data=pbc)
plot(survfit.0)
plot(prodlim.0,add=TRUE,col=2,lwd=3)
#+END_SRC   

#+RESULTS[<2014-12-09 17:20:55> 1d84de430eb24eaa66dcf01b51d70ea7876c3f17]:
[[file:~/research/SoftWare/prodlim/test/compSurvival.png]]

#+BEGIN_SRC R :exports both :results output   :session *R* :cache no :eval never
  ttt <- sort(unique(d$time)[d$event==1])
  ttt <- ttt[-length(ttt)]
  sum0.s <- summary(survfit.0,times=ttt)
  plot(survfit.0,lwd=6)
  plot(prodlim.0,add=TRUE,col=2)
  ## There is arounding issue:
  library(survival)
  testdata <- data.frame(time=c(16.107812,3.657545,1.523978),event=c(0,1,1))
  sum0 <- summary(survfit(Surv(time,event)~1,data=testdata),times=sort(testdata$time))
  testdata$timeR <- round(testdata$time,1)
  sum1 <- summary(survfit(Surv(timeR,event)~1,data=testdata),times=sort(testdata$time))
  sum0
  sum1
  ## sum0 != sum1
  ## summary(survfit.0,times=c(0,0.1,0.2,0.3))
  result.survfit <- data.frame(time=sum0.s$time,n.risk=sum0.s$n.risk,n.event=sum0.s$n.event,surv=sum0.s$surv,std.err=sum0.s$std.err,lower=sum0.s$lower,upper=sum0.s$upper)
  result.prodlim <- data.frame(summary(prodlim.0,times=ttt)$table[,c("time","n.risk","n.event","n.lost","surv","se.surv","lower","upper")])
  cbind(result.survfit[,c("time","n.risk","n.event","surv")],result.prodlim[,c("time","n.risk","n.event","surv")])
  a <- round(result.survfit$surv,8)
  b <- round(result.prodlim$surv[!is.na(result.prodlim$se.surv)],8)
  if (all(a==b)){cat("\nOK\n")}else{cat("\nERROR\n")}
  if (all(round(result.survfit$std.err,8)==round(result.prodlim$se.surv[!is.na(result.prodlim$se.surv)],8))){cat("\nOK\n")}else{cat("\nERROR\n")}
#+END_SRC   


** Bootstrap weights

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/bw.png" :exports both :session *R* :cache yes 
pbc <- pbc[order(pbc$time,-pbc$status),]
set.seed(17)
boot <- sample(1:NROW(pbc),size=NROW(pbc),replace=TRUE)
boot.weights <- table(factor(boot,levels=1:NROW(pbc)))
s1 <- prodlim(Hist(time,status>0)~1,data=pbc,caseweights=boot.weights)
plot(s1,col=1,confint=FALSE,lwd=8)
s2 <- prodlim(Hist(time,status>0)~1,data=pbc[sort(boot),])
plot(s2,add=TRUE,col=2,confint=FALSE,lwd=3)
#+END_SRC   

#+RESULTS[<2014-12-09 17:20:55> 8b35866bf972c241101784892b6610e45b1ae12e]:
[[file:~/research/SoftWare/prodlim/test/bw.png]]

** Case-weights 

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compSurvey.png" :exports both :session *R* :cache yes 
library(survey)
library(survival)
library(prodlim)
pbc <- pbc[order(pbc$time,-pbc$status),]
## pbc$randprob<-fitted(biasmodel)
## pbc$randprob <- as.numeric(pbc$sex=="m")+0.1
set.seed(17)
pbc$randprob <- abs(rnorm(NROW(pbc)))
dpbc <- svydesign(id=~id, weights=~randprob, strata=NULL, data=pbc)
survey.1<-svykm(Surv(time,status>0)~1, design=dpbc)
plot(survey.1,lwd=8)
prodlim.1 <- prodlim(Hist(time,status>0)~1,data=pbc,caseweights=pbc$randprob)
plot(prodlim.1,add=TRUE,col=2,confint=FALSE)
#+END_SRC   

#+RESULTS[<2014-12-09 17:20:56> dec8932742395595e2951caa82e65c23c49f5c76]:
[[file:~/research/SoftWare/prodlim/test/compSurvey.png]]

** delayed entry 
*** Without covariates

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/d0.png" :exports results :session *R* :cache yes 
pbc$entry <- round(pbc$time/5)
survfit.delay <- survfit(Surv(entry,time,status!=0)~1,data=pbc)
prodlim.delay <- prodlim(Hist(time,status!=0,entry=entry)~1,data=pbc)
plot(survfit.delay,lwd=8)
plot(prodlim.delay,lwd=4,col=2,add=TRUE,confint=FALSE)
#+END_SRC

#+RESULTS[<2014-12-09 17:20:56> ef968754c92ada9a114bdb475ba1c4fc3127bb26]:
[[file:~/research/SoftWare/prodlim/test/d0.png]]

    
*** With covariates

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compSurvDelayEdema.png" :exports both :session *R* :cache yes 
  pbc0 <- pbc
  pbc0$entry <- round(pbc0$time/5)
  survfit.delay.edema <- survfit(Surv(entry,time,status!=0)~edema,data=pbc0)
  ## survfit.delay.edema.0.5 <- survfit(Surv(entry,time,status!=0)~1,data=pbc0[pbc0$edema==0.5,])
  prodlim.delay.edema <- prodlim(Hist(time,status!=0,entry=entry)~edema,data=pbc0)
  ## prodlim.delay.edema.0.5 <- prodlim(Hist(time,status!=0,entry=entry)~1,data=pbc0[pbc0$edema==0.5,])
  plot(survfit.delay.edema,conf.int=FALSE,col=1:3,lwd=8)
  plot(prodlim.delay.edema,add=TRUE,confint=FALSE,col=c("gray88","orange",5),lwd=4)
#+END_SRC    

#+RESULTS[<2014-12-09 17:20:56> f9a50518b02047f0f0eb6653bd8036c4210382b6]:
[[file:~/research/SoftWare/prodlim/test/compSurvDelayEdema.png]]


** Stacked plot
  
#+BEGIN_SRC R :results graphics  :file "~/research/SoftWare/prodlim/test/aj.png" :exports both :session *R* :cache no 
library(riskRegression)
data(Melanoma)
aj <- prodlim(Hist(time,Event)~1,data=d)
plot(aj,cause="stacked")
#+END_SRC

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/aj.png]]

** Competing risks with delayed entry 
*** Without covariates

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compETM3.png" :exports both :session *R* :cache yes 
library(etm)
data(abortion)
cif.ab.etm <- etmCIF(Surv(entry, exit, cause != 0) ~ 1,abortion,etype = cause,failcode = 3)
cif.ab.prodlim <- prodlim(Hist(time=exit, event=cause,entry=entry) ~ 1,data=abortion)
plot(cif.ab.etm,lwd=8,col=3)
plot(cif.ab.prodlim,add=TRUE,lwd=4,col=5,cause=3)
#+END_SRC   

#+RESULTS[<2014-12-09 17:20:56> 2ac5105fe858184184203c412d8346d051568eff]:
[[file:~/research/SoftWare/prodlim/test/compETM3.png]]

#+BEGIN_SRC R :results graphics  :file "~/research/SoftWare/prodlim/test/compETM22.png" :exports both :session *R* :cache no 
library(etm)
data(abortion)
x <- prodlim(Hist(time=exit, event=cause,entry=entry) ~ 1,data=abortion)
x0 <- etmCIF(Surv(entry, exit, cause != 0) ~ 1,abortion,etype = cause)
par(mfrow=c(2,2))
cif.ab.etm <- etmCIF(Surv(entry, exit, cause != 0) ~ 1,abortion,etype = cause,failcode = 3)
cif.ab.prodlim <- prodlim(Hist(time=exit, event=cause,entry=entry) ~ 1,data=abortion)
# cause 3
plot(cif.ab.etm, ci.type = "bars", pos.ci = 24, col = c(1, 2), lty = 1,which.cif=3,lwd=8)
plot(cif.ab.prodlim,add=TRUE,cause=3,confint=TRUE,col=2)
# cause 2
plot(cif.ab.etm, ci.type = "bars", pos.ci = 24, col = c(1, 2), lty = 1,which.cif=2,lwd=8)
plot(cif.ab.prodlim,add=TRUE,cause=2,confint=TRUE,col=2)
# cause 1
plot(cif.ab.etm, ci.type = "bars", pos.ci = 24, col = c(1, 2), lty = 1,which.cif=1,lwd=8)
plot(cif.ab.prodlim,add=TRUE,cause=1,confint=TRUE,col=2)
#+END_SRC

#+RESULTS:
[[file:~/research/SoftWare/prodlim/test/compETM22.png]]

    
*** With covariates

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compETMcovariate.png" :exports results :session *R* :cache yes 
library(etm)
data(abortion)
cif.ab.etm <- etmCIF(Surv(entry, exit, cause != 0) ~ group,abortion,etype = cause,failcode = 3)
names(cif.ab.etm[[1]])
head(cbind(cif.ab.etm[[1]]$time,cif.ab.etm[[1]]$n.risk))
cif.ab.prodlim <- prodlim(Hist(time=exit, event=cause,entry=entry) ~ group,data=abortion)
plot(cif.ab.etm, ci.type = "bars", pos.ci = 24, col = c(1, 2), lty = 1, curvlab = c("Control", "Exposed"),lwd=8)
plot(cif.ab.prodlim,add=TRUE,cause=3,confint=FALSE,col="yellow")
#+END_SRC

#+RESULTS[<2014-12-09 17:20:57> 97f915ecd581609e1fe3fefa5cd1932a206259cd]:
[[file:~/research/SoftWare/prodlim/test/compETMcovariate.png]]

#+BEGIN_SRC R  :results output   :exports both  :session *R* :cache no :eval never
library(survival)
library(prodlim)
library(etm)
testdata <- data.frame(entry=c(1,5,2,8,5),exit=c(10,6,4,12,33),event=c(0,1,0,1,0))
cif.test.etm <- etmCIF(Surv(entry, exit, event) ~ 1,data=testdata,etype = event,failcode = 1)
cif.test.survival <- survfit(Surv(entry, exit, event) ~ 1,data=testdata)
cif.test.prodlim <- prodlim(Hist(exit,event,entry=entry)~1,data=testdata)
plot(cif.test.etm, ci.type = "bars", pos.ci = 24, lwd=5)
plot(cif.test.etm, ci.type = "bars", pos.ci = 24, lwd=5)
plot(cif.test.prodlim,add=TRUE,cause=2,col=2,confint=TRUE,type="cuminc")
#+END_SRC

* Interval censored data and illness-death model

** Delayed entry into illstate
   
#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compSurvDelayedIDM.png" :exports results :session *R* :cache yes 
library(SmoothHazard)
library(survival)
library(prodlim)
## simulate data from an illness-death model
mod <- idmModel(K=10,schedule=0,punctuality=1)
regression(mod,from="X",to="lifetime") <- log(2)
regression(mod,from="X",to="waittime") <- log(2)
regression(mod,from="X",to="illtime") <- log(2)
set.seed(137)
## we round the event times to have some ties
testdata <- round(sim(mod,250),1)
## the data enter with delay into the intermediate state (ill)
## thus, to estimate the cumulative incidence of
## the absorbing state (death) after illness we 
## have left-truncated data
illdata <- testdata[testdata$illstatus==1,]
illdata <- illdata[order(illdata$lifetime,-illdata$seen.exit),]
## sindex(jump.times=illdata$illtime,eval.times=illdata$lifetime)
## F <- prodlim(Hist(lifetime,status,entry=illtime)~1,data=illdata[1:5,])
## f <- survfit(Surv(illtime,lifetime,status)~1,data=illdata[1:5,],type="kaplan-meier")
survfit.delayed.ill <- survfit(Surv(illtime,lifetime,seen.exit)~1,data=illdata)
prodlim.delayed.ill <- prodlim(Hist(lifetime,seen.exit,entry=illtime)~1,data=illdata)
plot(survfit.delayed.ill,lwd=5)
plot(prodlim.delayed.ill,lwd=2,col=2,add=TRUE)
#+END_SRC

#+RESULTS[<2014-12-09 17:20:57> b2533f1e7196ff6cc6a036d9ea72fff57c3370a0]:
[[file:~/research/SoftWare/prodlim/test/compSurvDelayedIDM.png]]

** Interval censored data

#+BEGIN_SRC R :results graphics :file "~/research/SoftWare/prodlim/test/compNMLE.png" :exports results :session *R* :cache yes 
icens <- prodlim(Hist(time=list(L,R),event=seen.ill)~1,data=illdata)
plot(icens)
#+END_SRC

#+RESULTS[<2014-12-09 17:20:57> c6ccfbe3317db857b4a59c8cfb46a546ab51d31e]:
[[file:~/research/SoftWare/prodlim/test/compNMLE.png]]

* COMMENT HEADER

#+TITLE: Testing the prodlim package
#+LANGUAGE:  en
#+OPTIONS:   H:3 num:t toc:t \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:t skip:nil d:t todo:t pri:nil tags:not-in-toc author:nil
#+LaTeX_CLASS: org-article
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://192.38.117.59/~tag/styles/practicals.css" />
#+LaTeX_HEADER:\usepackage{authblk}
#+LaTeX_HEADER:\author{Thomas Alexander Gerds}
#+PROPERTY: session *R*
#+PROPERTY: cache no
